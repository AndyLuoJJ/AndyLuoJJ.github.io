<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Notification Center ä¸ UNUserNotification | Andyçš„å°ä¹¦æ¶</title>
<meta name="description" content="è¿™æ˜¯æˆ‘çš„ä¸ªäººåšå®¢ï¼Œå¸Œæœ›èƒ½å¤ŸåšæŒå†™ä¸€ä¸‹è‡ªå·±å„æ–¹é¢çš„å¿ƒå¾—ğŸ˜ƒ" />
<link rel="shortcut icon" href="https://AndyLuoJJ.github.io/favicon.ico?v=1585061940520">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://AndyLuoJJ.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://AndyLuoJJ.github.io">
  <img class="avatar" src="https://AndyLuoJJ.github.io/images/avatar.png?v=1585061940520" alt="">
  </a>
  <h1 class="site-title">
    Andyçš„å°ä¹¦æ¶
  </h1>
  <p class="site-description">
    è¿™æ˜¯æˆ‘çš„ä¸ªäººåšå®¢ï¼Œå¸Œæœ›èƒ½å¤ŸåšæŒå†™ä¸€ä¸‹è‡ªå·±å„æ–¹é¢çš„å¿ƒå¾—ğŸ˜ƒ
  </p>
  <div class="menu-container">
    
      
        <a href="https://AndyLuoJJ.github.io" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="https://AndyLuoJJ.github.io/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="https://AndyLuoJJ.github.io/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="https://andy_luo.gitee.io/personal_resume/" class="menu" target="_blank">
          ä¸ªäººç®€å†
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Notification Center ä¸ UNUserNotification
            </h2>
            <div class="post-info">
              <span>
                2020-03-24
              </span>
              <span>
                24 min read
              </span>
              
                <a href="https://AndyLuoJJ.github.io/tag/Iy1uCjZ3x/" class="post-tag">
                  # å®˜æ–¹æ–‡æ¡£
                </a>
              
                <a href="https://AndyLuoJJ.github.io/tag/gbkj8_IZA/" class="post-tag">
                  # iOS
                </a>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>é‡æ–°æ¸©ä¹ ä¸€ä¸‹ä¸¤ä¸ªæˆªç„¶ä¸åŒçš„ notificationâ€”â€”ç”¨äºå†…éƒ¨æ¶ˆæ¯ä¼ é€’çš„ Notification Center å’Œ iOS åº”ç”¨æ¨é€ User Notificationã€‚</p>
<!-- more -->
<h2 id="ä¸€-ä»‹ç»">ä¸€ã€ä»‹ç»</h2>
<p>â€œnotificationâ€æ„ä¸ºâ€œé€šçŸ¥â€ï¼Œå³ç”±ä¸€æ–¹å‘å¦ä¸€æ–¹å‘å‡ºä¸€ä¸ªæé†’ï¼Œå‘Šè¯‰å¯¹æ–¹æŸäº›äº‹æƒ…å·²ç»å®Œæˆï¼Œæˆ–è€…å·²ç»è¾¾åˆ°æŸä¸ªçŠ¶æ€ç­‰ã€‚åœ¨å®é™…ç”Ÿæ´»ä¸­ï¼Œè¿™ç§æ¶ˆæ¯é€šçŸ¥çš„æ¨¡å¼éšå¤„å¯è§ï¼šå¿«é€’å°å“¥å‘çŸ­ä¿¡è¯´æœ‰å¿«é€’åˆ°æ¥¼ä¸‹äº†ã€å¤–å–å°å“¥æ‰“ç”µè¯è¯´æœ‰å¤–å–åˆ°æ¥¼ä¸‹äº†ã€è€æ¿é€šçŸ¥ä½ ä¸‹åˆè¦å¼€ä¼šï¼Œç­‰ç­‰ã€‚æˆ‘ä»¬çš„å¤§è„‘åœ¨æ¥æ”¶å¹¶å¤„ç†è¿™äº›é€šçŸ¥ä¹‹åï¼Œåˆä¼šå‘å‡ºâ€œé€šçŸ¥â€åè°ƒæˆ‘ä»¬çš„èº«ä½“æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼šå¤§è„‘é€šçŸ¥è„šè¦ä¸‹æ¥¼äº†ã€å¤§è„‘é€šçŸ¥è„šè¦ä¸‹æ¥¼äº†ã€å¤§è„‘é€šçŸ¥æ‰‹è¦å¼€å§‹å†™æŠ¥å‘Šäº†ï¼Œç­‰ç­‰ã€‚æœ€ç»ˆï¼Œè¿™äº›é€šçŸ¥å¯èƒ½ä¼šåˆ°è¾¾æŸä¸€ä¸ªç»ˆç«¯ï¼Œå¹¶è§¦å‘å…¶æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚</p>
<p>åœ¨ iOS å¼€å‘ä¸­ï¼Œæ ¹æ®é€šçŸ¥çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„ä¸åŒï¼Œå¤§è‡´æœ‰ä¸¤ç§ä¸åŒç±»å‹çš„é€šçŸ¥ï¼š</p>
<ol>
<li>åº”ç”¨å‘ç»™ç”¨æˆ·çš„é€šçŸ¥</li>
<li>ç³»ç»Ÿå‘ç»™å¼€å‘è€…çš„é€šçŸ¥</li>
</ol>
<p>ç¬¬ä¸€ç§é€šçŸ¥æ˜¯æ‰€æœ‰æ™ºèƒ½æ‰‹æœºç”¨æˆ·éƒ½éå¸¸ç†Ÿæ‚‰çš„<strong>æ¨é€</strong>ï¼Œä¾‹å¦‚åœ¨ç‰¹å®šçš„æ—¶é—´ App ä¼šå¼¹å‡ºæ¨é€æ¡†å‘ç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼›ç¬¬äºŒç§é€šçŸ¥æ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ï¼Œå¼€å‘è€…å¯ä»¥å‘ä¸€ä¸ªâ€œé€šçŸ¥ç®¡ç†è€…â€æ³¨å†ŒæŸä¸ªé€šçŸ¥ï¼Œå‘Šè¯‰â€œç®¡ç†è€…â€ã€Œæˆ‘éœ€è¦å‘å“ªäº›å¯¹è±¡å‘é€é€šçŸ¥ã€ï¼Œç„¶ååœ¨å¿…è¦çš„æ—¶å€™å‘â€œç®¡ç†è€…â€å‘é€ç›¸åº”çš„é€šçŸ¥å³å¯ï¼Œâ€œé€šçŸ¥ç®¡ç†è€…â€ä¼šå‘æ³¨å†Œæ—¶ç™»è®°çš„å¯¹è±¡å‘é€ç›¸åº”çš„é€šçŸ¥ã€‚</p>
<h2 id="äºŒ-ç”¨äºå¼€å‘çš„é€šçŸ¥">äºŒã€ç”¨äºå¼€å‘çš„é€šçŸ¥</h2>
<p>æœ¬èŠ‚è®¨è®ºç”¨äºå¼€å‘çš„é€šçŸ¥ã€‚</p>
<p>Notification æ˜¯ iOS ç³»ç»Ÿä¸‹é‡è¦çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ä¹‹ä¸€ï¼Œæ¥è‡ªç³»ç»Ÿçš„é€šçŸ¥å°è£…äº†ä¸åŒçš„äº‹ä»¶ä¿¡æ¯ï¼Œè€Œè‡ªå®šä¹‰çš„é€šçŸ¥çš„å†…å®¹å¯ä»¥æ ¹æ®å®é™…éœ€è¦æ¥è®¾å®šã€‚</p>
<h3 id="notification-ä»‹ç»">Notification ä»‹ç»</h3>
<p>ç³»ç»Ÿå†…éƒ¨è¿›è¡Œæ¶ˆæ¯ä¼ é€’çš„é€šçŸ¥ï¼Œå®ç°äº†è§‚å¯Ÿè€…æ¨¡å¼ã€‚iOS çš„å®ç°æ–¹å¼æ˜¯éœ€è¦åœ¨é€šçŸ¥ä¸­å¿ƒï¼ˆNotificationCenterï¼‰ä¸­æ³¨å†Œé€šçŸ¥ï¼Œå‘Šè¯‰é€šçŸ¥ä¸­å¿ƒéœ€è¦å‘å“ªäº›å¯¹è±¡å‘é€é€šçŸ¥ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™ post ç›¸åº”çš„é€šçŸ¥å³å¯ã€‚å¯¹äºæ¥æ”¶é€šçŸ¥çš„å¯¹è±¡ï¼Œå¯ä»¥é€‰æ‹©ä»…æ¥æ”¶è‡ªå·±æ„Ÿå…´è¶£çš„é€šçŸ¥ã€‚åŒºåˆ†ä¸åŒé€šçŸ¥çš„æ–¹æ³•æ˜¯é‡‡ç”¨å­—ç¬¦ä¸²æˆ–æšä¸¾ä½œä¸ºé€šçŸ¥çš„ idã€‚</p>
<h3 id="notificationcenter">NotificationCenter</h3>
<p>NotificationCenter æ˜¯ä¸€ç§é€šçŸ¥çš„åˆ†å‘æœºåˆ¶ï¼Œå¯ä»¥å‘å·²æ³¨å†Œçš„è§‚å¯Ÿè€…è¿›è¡Œä¿¡æ¯çš„å¹¿æ’­ï¼ˆA notification dispatch mechanism that enables the broadcast of information to registered observersï¼‰ã€‚</p>
<h4 id="å®˜æ–¹æ–‡æ¡£è§£è¯»">å®˜æ–¹æ–‡æ¡£è§£è¯»</h4>
<p>Apple Developer ä»‹ç»äº†å‡ ä¸ª NotificationCenter ç±»çš„åŸºç¡€ç”¨æ³•ã€‚</p>
<ul>
<li>ï¼ˆ1ï¼‰è·å¾—é»˜è®¤çš„é€šçŸ¥ä¸­å¿ƒï¼š</li>
</ul>
<pre><code class="language-swift">NotificationCenter.default
</code></pre>
<p>NotificationCenter ç±»æœ‰ä¸€ä¸ªåä¸º default çš„ç±»å±æ€§ï¼Œç”¨äºè·å–è¿›ç¨‹é»˜è®¤çš„é€šçŸ¥ä¸­å¿ƒã€‚æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ Notification Centerã€‚</p>
<p>âš ï¸æ³¨æ„ç‚¹ï¼š</p>
<ol>
<li>é€šçŸ¥ä¸­å¿ƒåˆ†å‘ç»™è§‚å¯Ÿè€…å¤„ç†é‡‡ç”¨<strong>åŒæ­¥æœºåˆ¶</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŸä¸€å¯¹è±¡å‘é€ä¸€ä¸ªé€šçŸ¥æ—¶ï¼Œä¼šä¸€ç›´é˜»å¡åœ¨å‘é€æ–¹æ³•å†…ï¼Œç›´åˆ°é€šçŸ¥ä¸­å¿ƒå°†è¯¥é€šçŸ¥åˆ†å‘ç»™æ‰€æœ‰è§‚å¯Ÿè€…å¹¶ä¸”å…¨éƒ¨æˆåŠŸå¤„ç†è¿”å›åï¼Œå‘é€è€…æ‰èƒ½æ‰§è¡Œå…¶æ‰€åœ¨çº¿ç¨‹å†…çš„åç»­ä»£ç ã€‚å¦‚æœéœ€è¦å¼‚æ­¥å‘é€é€šçŸ¥ï¼Œå¯ä»¥ä½¿ç”¨ NotificationQueueï¼ˆåé¢æåŠï¼‰ã€‚</li>
<li>åœ¨å¤šçº¿ç¨‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œé€šçŸ¥æ€»æ˜¯åœ¨å‘é€çš„çº¿ç¨‹ä¸­ä¼ é€ï¼Œè¿™ä¸ªçº¿ç¨‹å¯èƒ½ä¸åŒäºè§‚å¯Ÿè€…æ³¨å†Œæ‰€åœ¨çš„çº¿ç¨‹ã€‚</li>
</ol>
<ul>
<li>ï¼ˆ2ï¼‰æ·»åŠ ä¸ç§»é™¤è§‚å¯Ÿè€…ï¼ˆæ¥æ”¶é€šçŸ¥çš„å¯¹è±¡ï¼‰ï¼š</li>
</ul>
<pre><code class="language-swift">func addObserver(_ observer: Any, selector aSelector: Selector, name aName: NSNotification.Name?, object anObject: Any?)

func addObserver(forName name: NSNotification.Name?, object obj: Any?, queue: OperationQueue?, using block: @escaping (Notification) -&gt; Void) -&gt; NSObjectProtocol

func removeObserver(_ observer: Any)

func removeObserver(_ observer: Any, name aName: NSNotification.Name?, object anObject: Any?)
</code></pre>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ol>
<li>observerï¼šæ¶ˆæ¯çš„æ¥æ”¶å¯¹è±¡</li>
<li>selectorï¼šæ¥æ”¶å¯¹è±¡æ¥æ”¶åˆ°é€šçŸ¥åæ‰§è¡Œçš„æ–¹æ³•ï¼Œéœ€è¦ä½¿ç”¨@objcè¿›è¡Œä¿®é¥°ã€‚å¦‚æœéœ€è¦åœ¨é€šçŸ¥çš„æ—¶å€™è¿›è¡Œæ•°æ®é€šä¿¡ï¼Œselector éœ€è¦æœ‰ä¸€ä¸ª Notification ç±»å‹çš„å‚æ•°ã€‚</li>
<li>nameï¼šé€šçŸ¥åç§°ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„é€šçŸ¥ï¼Œæ¥æ”¶è€…ä»…æ¥æ”¶è¿™ä¸ªåå­—çš„é€šçŸ¥ã€‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªå…³è”å€¼ä¸º String çš„ enumï¼Œé€šè¿‡ <code>Notification.Name.init()</code>åˆ›å»ºã€‚</li>
<li>objectï¼šæ¶ˆæ¯çš„æ¥æºï¼Œæ¥æ”¶è€…åªæ¥å—ä»è¿™ä¸ªå‘é€è€…å‘å‡ºæ¥çš„æ¶ˆæ¯ã€‚è®¾ç½®ä¸º nil è¡¨æ˜æ¥æ”¶å¯¹è±¡æ¥æ”¶æ‰€æœ‰æ¥æºçš„æŸä¸ªé€šçŸ¥ã€‚</li>
<li>queueï¼šå°† block å‚æ•°æ·»åŠ åˆ°å“ªä¸€ä¸ª OperationQueue ä¸Šï¼Œå¦‚æœä¸º nilï¼Œblock ä¼šåœ¨ post çš„çº¿ç¨‹ä¸Š<strong>åŒæ­¥æ‰§è¡Œ</strong>ã€‚</li>
<li>blockï¼šæ¥æ”¶å¯¹è±¡æ¥æ”¶åˆ°é€šçŸ¥åæ‰§è¡Œçš„é—­åŒ…ï¼Œ<strong>é€ƒé€¸é—­åŒ…</strong>ï¼ŒåŸºæœ¬ä¸Šå’Œ selector ç›¸åŒï¼Œä½†æ˜¯æ›´åŠ  Swifty ä¸€äº›ã€‚è¯¥ block ä¼šè¢«å¤åˆ¶åˆ°åˆ°é€šçŸ¥ä¸­å¿ƒï¼Œç›´è‡³ observer è¢«ç§»é™¤ã€‚</li>
</ol>
<ul>
<li>ï¼ˆ3ï¼‰å‘é€é€šçŸ¥ï¼š</li>
</ul>
<pre><code class="language-swift">func post(Notification)

func post(name: NSNotification.Name, object: Any?, userInfo: [AnyHashable : Any]?)

func post(name: NSNotification.Name, object: Any?)

</code></pre>
<p>å‚æ•°å«ä¹‰ä¸ addObserver åŸºæœ¬ç›¸åŒï¼Œå¤šå‡ºæ¥çš„ userInfo æ˜¯ç”¨è¿‡æ•°æ®é€šä¿¡çš„å‚æ•°ï¼Œåœ¨æ¥å—è€…çš„ selector/block ä¼šæœ‰ä¸€ä¸ª Notification ç±»å‹çš„å‚æ•°ï¼Œé€šè¿‡å‚æ•°çš„ userInfo å±æ€§è·å–åˆ°é€šçŸ¥å‘è¿‡æ¥çš„å‚æ•°ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨ post çš„æ—¶å€™å¹¶æ²¡æœ‰æ˜¾ç¤ºæŒ‡æ˜å“ªäº›å¯¹è±¡æ¥æ”¶é€šçŸ¥ï¼Œæ‰€æœ‰å­˜åœ¨çš„ MyObserver å®ä¾‹éƒ½ä¼šæ”¶åˆ°è¿™ä¸ªé€šçŸ¥ã€‚å› æ­¤ç¤ºä¾‹ä»£ç ä¼šå¼•å‘ä¸€ä¸ª warningï¼Œæç¤º observers å˜é‡è¢«å†™å…¥ï¼ˆç½®ç©ºï¼‰ä½†æœªè¢«è¯»å–ã€‚</p>
<h4 id="è‡ªå®šä¹‰é€šçŸ¥çš„æ³¨å†Œå’Œå“åº”">è‡ªå®šä¹‰é€šçŸ¥çš„æ³¨å†Œå’Œå“åº”</h4>
<p>é€šçŸ¥ç±»å‹å…¶å®å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±å®šä¹‰çš„é€šçŸ¥ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ userInfo å‚æ•°ä¼ é€’ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ã€‚</p>
<p>Example codeï¼š</p>
<pre><code class="language-swift">class MyObserver {
  
  var name: String = &quot;&quot;
  
  init(name: String) {
    self.name = name
    // è®¾ç½®é€šçŸ¥åç§°
    let notificationName = NSNotification.Name(rawValue: &quot;DownloadImageNotification&quot;)
    // æ·»åŠ è§‚å¯Ÿè€…
    NotificationCenter.default.addObserver(self, selector: #selector(downloadImage(notification:)), name: notificationName, object: nil)
  }

  @objc private func downloadImage(notification: Notification) {
    // ä½¿ç”¨ notification å‚æ•°è¿›è¡Œæ•°æ®é€šä¿¡
    let userInfo = notification.userInfo as! [String:Any]
    let value1 = userInfo[&quot;value1&quot;] as! String
    let value2 = userInfo[&quot;value2&quot;] as! Int
    print(&quot;\(name)è·å–åˆ°é€šçŸ¥ï¼Œç”¨æˆ·æ•°æ®æ˜¯[\(value1), \(value2)]&quot;)
    sleep(3)
    print(&quot;\(name)æ‰§è¡Œå®Œæ¯•&quot;)
  }

  deinit {
    // ç§»é™¤è§‚å¯Ÿè€…
    NotificationCenter.default.removeObserver(self)
    print(&quot;åˆ é™¤\(name)&quot;)
  }
  
}

class ViewController: UIViewController {
  
  override func viewDidLoad() {
    super.viewDidLoad()
    // create custom observers
  	var observers = [MyObserver(name: &quot;è§‚å¯Ÿå™¨1&quot;)]
    print(&quot;å‘é€é€šçŸ¥&quot;)
    let notificationName = Notification.Name(rawValue: &quot;DownloadImageNotification&quot;)
    // å‘é€åŒåé€šçŸ¥
    NotificationCenter.default.post(name: notificationName, object: self, userInfo: [&quot;value1&quot;:&quot;ç”¨æˆ·å&quot;, &quot;value2&quot;:12345])
    print(&quot;é€šçŸ¥å®Œæ¯•&quot;)
    observers = []
  }

}

</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://andy_luo.gitee.io/blog_image_bed/img/notification_center_output.jpg" alt="æ™®é€š post è¿è¡Œç»“æœ" loading="lazy"></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸»çº¿ç¨‹è°ƒç”¨ post å‘å‡ºé€šçŸ¥åï¼Œä¼šç«‹å³åœ¨ post çš„çº¿ç¨‹ä¸ŠåŒæ­¥æ‰§è¡Œ selectorã€‚å¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸Šå‘å‡ºé€šçŸ¥åæ‰§è¡Œçš„æ“ä½œæ¯”è¾ƒè€—è´¹æ—¶é—´ï¼Œéœ€è¦å°†è€—æ—¶ä»»åŠ¡åˆ†åˆ°å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-swift">@objc private func downloadImage(notification: Notification) {
  // ä½¿ç”¨ GCD å°†ä»»åŠ¡æ”¾å…¥å…¨å±€å¼‚æ­¥çº¿ç¨‹ä¸­
  DispatchQueue.global().async {
    // userInfo is used to transfer user defined data
    let userInfo = notification.userInfo as! [String:Any]
    let value1 = userInfo[&quot;username&quot;] as! String
    let value2 = userInfo[&quot;id&quot;] as! Int
    print(&quot;\(self.name)è·å–åˆ°é€šçŸ¥ï¼Œç”¨æˆ·åï¼š\(value1), å¯†ç ï¼š\(value2)&quot;)
    sleep(3)
    print(&quot;\(self.name)æ‰§è¡Œå®Œæ¯•&quot;)
  }
}
</code></pre>
<p>è¿è¡Œç»“æœå˜ä¸ºä¸‹å›¾ï¼Œæ­¤æ—¶ä¸»çº¿ç¨‹æ²¡æœ‰è¢«é˜»å¡ã€‚ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://andy_luo.gitee.io/blog_image_bed/img/notification_center_output_concurrent.jpg" alt="å°†è€—æ—¶ä»»åŠ¡åˆ†åˆ°å…¨å±€å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œ" loading="lazy"></figure>
<h4 id="ç³»ç»Ÿé€šçŸ¥çš„æ³¨å†Œå’Œå“åº”">ç³»ç»Ÿé€šçŸ¥çš„æ³¨å†Œå’Œå“åº”</h4>
<p>é™¤äº†è‡ªå®šä¹‰çš„é€šçŸ¥ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿å¯¹è±¡æ¥æ”¶ iOS ç³»ç»Ÿå‘æ¥çš„é€šçŸ¥ã€‚ç³»ç»Ÿé€šçŸ¥å®é™…ä¸Šæ˜¯ä¸€ä¸ªæœ‰ç€ç‰¹æ®Šåå­—çš„é€šçŸ¥ï¼ŒNotification.Name çš„æšä¸¾å€¼åŒ…å«äº†ä¸€ç³»åˆ—ç³»ç»Ÿé€šçŸ¥ï¼Œå…·ä½“å¯ç”¨é€‰é¡¹æ¯”è¾ƒå¤šï¼Œè¯·å‚è€ƒ<a href="https://developer.apple.com/documentation/foundation/nsnotification/name">å®˜æ–¹æ–‡æ¡£</a></p>
<p>Example code:</p>
<pre><code class="language-swift">// create an instance of notification center
let nc = NotificationCenter.default

// fetch the main queue
let queue = OperationQueue.main

// add an observer which listens to the UIApplicationDidEnterBackground notification.
let observer = nc.addObserver(forName: .UIApplicationDidEnterBackground, object: nil, queue: queue) {
  noti in
  print(&quot;Entering background...&quot;)
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°æ¥æ”¶ç³»ç»Ÿé€šçŸ¥å’Œæ¥æ”¶è‡ªå®šä¹‰é€šçŸ¥åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚</p>
<h3 id="notificationqueue">NotificationQueue</h3>
<p>åœ¨ NotificationCenter ä¸­ï¼Œpost å‡ºå»çš„é€šçŸ¥ä¼šé©¬ä¸Šåˆ°è¾¾ observer æ‰‹ä¸­ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä½¿é€šçŸ¥å»¶è¿Ÿä¸€æ®µæ—¶é—´åå†è¿›è¡Œå¹¿æ’­ï¼Œå¯ä»¥ä½¿ç”¨ NotificationQueue å¯¹ Notification è¿›è¡Œç®¡ç†ã€‚NotificationQueue ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ï¼Œenqueue çš„é€šçŸ¥ä¸ä¼šç«‹åˆ»å‘é€åˆ° observerï¼Œè€Œæ˜¯åœ¨ dequeue çš„æ—¶å€™å°†æ»¡è¶³æ¡ä»¶çš„ Notification æŒ‰å…ˆè¿›å…ˆå‡ºçš„é¡ºåºé€ä¸ªè¿›è¡Œå‘é€ã€‚</p>
<h4 id="å®˜æ–¹æ–‡æ¡£è§£è¯»-2">å®˜æ–¹æ–‡æ¡£è§£è¯»</h4>
<ul>
<li>ï¼ˆ1ï¼‰åˆ›å»ºé˜Ÿåˆ—ï¼š</li>
</ul>
<pre><code class="language-swift">NotificationQueue.init(notificationCenter: NotificationCenter)
</code></pre>
<p>å¯ä»¥å°†å½“å‰çº¿ç¨‹çš„é€šçŸ¥å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šã€‚</p>
<ul>
<li>ï¼ˆ2ï¼‰è·å¾—é»˜è®¤é˜Ÿåˆ—ï¼š</li>
</ul>
<pre><code class="language-swift">NotificationQueue.default
</code></pre>
<p>è·å¾—å½“å‰çº¿ç¨‹çš„é»˜è®¤é€šçŸ¥é˜Ÿåˆ—ã€‚ä¸€èˆ¬æ¥è¯´ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ä¸€ä¸ªé€šçŸ¥ä¸­å¿ƒã€ç»´æŠ¤ä¸€ä¸ªé€šçŸ¥é˜Ÿåˆ—ã€‚</p>
<ul>
<li>ï¼ˆ3ï¼‰é€šçŸ¥å…¥åˆ—ä¸å‡ºåˆ—ï¼š</li>
</ul>
<pre><code class="language-swift">func enqueue(Notification, postingStyle: NotificationQueue.PostingStyle, coalesceMask: NotificationQueue.NotificationCoalescing, forModes: [RunLoop.Mode]?)

func enqueue(Notification, postingStyle: NotificationQueue.PostingStyle)

func dequeueNotifications(matching: Notification, coalesceMask: Int)
</code></pre>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ol>
<li>matchingï¼šç”¨äºè¿›è¡Œåˆ¤æ–­çš„â€œæ¨¡æ¿â€é€šçŸ¥ã€‚</li>
<li>postingStyleï¼šæšä¸¾å€¼ï¼ŒæŒ‡æ˜å‘é€é€šçŸ¥çš„æ—¶é—´ï¼Œå¯ä»¥æ˜¯ asapã€whenIdleã€now ä¸‰è€…ä¹‹ä¸€ï¼Œåˆ†åˆ«è¡¨ç¤ºå½“å‰é€šçŸ¥å›è°ƒç»“æŸæ—¶ã€çº¿ç¨‹ç©ºé—²æ—¶ã€ç«‹åˆ»å‘é€ã€‚</li>
<li>coalesceMaskï¼šå±è”½ä½ï¼ŒæŒ‡æ˜å±è”½é€šçŸ¥çš„æ–¹å¼ã€‚0 è¡¨ç¤ºä¸å±è”½ï¼Œå¥‡æ•°è¡¨ç¤ºå±è”½ä¸ matching åŒåçš„é€šçŸ¥ï¼Œå¶æ•°è¡¨ç¤ºå±è”½ä¸ matching åŒå‘é€è€…çš„é€šçŸ¥ã€‚</li>
<li>forModesï¼šè§„å®šåªèƒ½åœ¨ RunLoop å¤„äºå“ªäº›æ¨¡å¼ä¸­çš„æ—¶å€™æ‰èƒ½å‘é€é€šçŸ¥ã€‚</li>
</ol>
<p>åœ¨ dequeue çš„æ—¶å€™ï¼Œé€šçŸ¥æ˜¯æŒ‰ç…§ enqueue çš„é¡ºåºå‡ºæ¥çš„ï¼Œå¦‚æœéœ€è¦å±è”½çš„è¯ï¼Œé€šçŸ¥ä¸­å¿ƒå°±ä¸ä¼šå°†è¢«å±è”½çš„é€šçŸ¥å¹¿æ’­å‡ºå»ã€‚</p>
<h4 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h4>
<pre><code class="language-swift">import UIKit
import NotificationCenter

class MyObserver {
    var name: String = &quot;&quot;
    init(name: String) {
        self.name = name
        // è®¾ç½®é€šçŸ¥åç§°
        let notiName1 = Notification.Name(rawValue: &quot;StatusNotification&quot;)
        let notiName2 = Notification.Name(rawValue: &quot;DownloadImageNotification&quot;)
        let notiName3 = Notification.Name(rawValue: &quot;AlertNotification&quot;)
        
        NotificationCenter.default.addObserver(self, selector: #selector(statusCheck(notification:)), name: notiName1, object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(downloadImage(notification:)), name: notiName2, object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(handleAlert(notification:)), name: notiName3, object: nil)
    }
    
    @objc private func statusCheck(notification: Notification) {
        // userInfo is used to transfer user defined data
        let userInfo = notification.userInfo as! [String:Any]
        guard let type = userInfo[&quot;type&quot;] as? String, let username = userInfo[&quot;username&quot;] as? String, let userID = userInfo[&quot;id&quot;] as? Int else {
            print(&quot;Error in parsing parameters&quot;)
            return
        }
        print(&quot;\(self.name)è·å–åˆ°é€šçŸ¥\(notification.name)&quot;)
        print(&quot;ç±»å‹ï¼š\(type), ç”¨æˆ·åï¼š\(username), IDï¼š\(userID)&quot;)
        print(&quot;\(self.name)æ‰§è¡Œå®Œæ¯•\(notification.name)&quot;)
        print(&quot;--------------------&quot;)
        sleep(2)
    }
    
    @objc private func downloadImage(notification: Notification) {
        // userInfo is used to transfer user defined data
        let userInfo = notification.userInfo as! [String:Any]
        guard let imageName = userInfo[&quot;imageName&quot;] as? String, let url = userInfo[&quot;url&quot;] as? String else {
            print(&quot;Error in parsing parameters&quot;)
            return
        }
        print(&quot;\(self.name)è·å–åˆ°é€šçŸ¥\(notification.name)&quot;)
        print(&quot;å›¾ç‰‡åï¼š\(imageName), é“¾æ¥ï¼š\(url)&quot;)
        print(&quot;\(self.name)æ‰§è¡Œå®Œæ¯•\(notification.name)&quot;)
        print(&quot;--------------------&quot;)
        sleep(2)
    }
    
    @objc private func handleAlert(notification: Notification) {
        // userInfo is used to transfer user defined data
        let userInfo = notification.userInfo as! [String:Any]
        guard let reason = userInfo[&quot;reason&quot;] as? String, let code = userInfo[&quot;code&quot;] as? Int else {
            print(&quot;Error in parsing parameters&quot;)
            return
        }
        print(&quot;\(self.name)è·å–åˆ°é€šçŸ¥\(notification.name)&quot;)
        print(&quot;åŸå› ï¼š\(reason), é”™è¯¯ä»£ç ï¼š\(code)&quot;)
        print(&quot;\(self.name)æ‰§è¡Œå®Œæ¯•\(notification.name)&quot;)
        print(&quot;--------------------&quot;)
        sleep(2)
    }
    
    deinit {
        // åœ¨ deinit ä¸­ç§»é™¤è§‚å¯Ÿè€…
        NotificationCenter.default.removeObserver(self)
        print(&quot;åˆ é™¤\(name)&quot;)
    }
    
}

class ViewController: UIViewController {
    // create custom observers
    let observers = [MyObserver(name: &quot;è§‚å¯Ÿå™¨1&quot;)]
    
    override func viewDidLoad() {
        super.viewDidLoad()
        print(&quot;å‘é€é€šçŸ¥&quot;)
        
        let notiName1 = Notification.Name(rawValue: &quot;StatusNotification&quot;)
        let notiName2 = Notification.Name(rawValue: &quot;DownloadImageNotification&quot;)
        let notiName3 = Notification.Name(rawValue: &quot;AlertNotification&quot;)
        
        let noti1 = Notification(name: notiName1, object: self, userInfo: [&quot;type&quot;:&quot;log in&quot;, &quot;username&quot;:&quot;Andy&quot;, &quot;id&quot;:12345])
        let noti2 = Notification(name: notiName2, object: self, userInfo: [&quot;imageName&quot;:&quot;Apple&quot;, &quot;url&quot;:&quot;https://www.apple.com&quot;])
        let noti3 = Notification(name: notiName3, object: self, userInfo: [&quot;reason&quot;:&quot;Page Not Found&quot;, &quot;code&quot;:404])
        let noti4 = Notification(name: notiName1, object: self, userInfo: [&quot;type&quot;:&quot;log out&quot;, &quot;username&quot;:&quot;Andy&quot;, &quot;id&quot;:12345])
        
        print(&quot;å…¥åˆ—ä¸‰ä¸ªé€šçŸ¥&quot;)
        let queue = NotificationQueue.default
        queue.enqueue(noti1, postingStyle: .whenIdle)
        queue.enqueue(noti2, postingStyle: .whenIdle)
        queue.enqueue(noti3, postingStyle: .whenIdle)
        print(&quot;å…¥åˆ—å®Œæ¯•&quot;)
        
        print(&quot;å‡ºåˆ—ä¸‰ä¸ªé€šçŸ¥&quot;)
        queue.dequeueNotifications(matching: noti1, coalesceMask: 0)
        queue.dequeueNotifications(matching: noti2, coalesceMask: 0)
        queue.dequeueNotifications(matching: noti3, coalesceMask: 0)
        print(&quot;å‡ºåˆ—å®Œæ¯•&quot;)
        
        // å¯¹æ¯”åŒæ­¥ post
        NotificationCenter.default.post(noti4)
        
        print(&quot;é€šçŸ¥å®Œæ¯•&quot;)
    }
    
}
</code></pre>
<p>ä¸ºæ–¹ä¾¿èµ·è§ï¼Œåœ¨ä»£ç ä¸­ä»…è®¾ç½®äº†ä¸€ä¸ª observer å¯¹å¤šä¸ªé€šçŸ¥è¿›è¡Œç›‘å¬ï¼Œå°†ä¸‰ä¸ªä¸åŒåçš„é€šçŸ¥å…¥åˆ—ï¼Œè§„å®šåœ¨çº¿ç¨‹ç©ºé—²çš„æ—¶å€™æ‰å‘é€é€šçŸ¥ï¼Œå¹¶ä¸”å…¨éƒ¨ä¸å±è”½åœ°å‘é€ã€‚ä¸ºè¿›è¡Œå¯¹æ¯”ï¼Œåœ¨å‡ºåˆ—å®Œæ¯•åå¢åŠ äº†ä¸€ä¸ªæ™®é€šçš„åŒæ­¥ postã€‚</p>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://andy_luo.gitee.io/blog_image_bed/img/noti_queue.jpg" alt="NotificationQueue è¿è¡Œç»“æœ" loading="lazy"></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ enqueue é€šçŸ¥åï¼Œæ¥æ”¶è€…æ²¡æœ‰é©¬ä¸Šæ”¶åˆ°æ¶ˆæ¯ï¼Œè€Œæ˜¯åœ¨ dequeue é€šçŸ¥åå¹¶ä¸”è¾¾åˆ° postingStyle è®¾ç½®çš„æ—¶æœºæ‰ä¼šç»Ÿä¸€å‘é€é€šçŸ¥ï¼Œè€Œä½œä¸ºå¯¹æ¯”çš„åŒæ­¥ post æ˜¯é©¬ä¸Šé˜»å¡å½“å‰çº¿ç¨‹å‘é€é€šçŸ¥ã€‚å¦‚æœå°† postingStyle è®¾ç½®ä¸º .now çš„è¯ï¼Œä¼šè·Ÿæ™®é€šçš„ post ä¸€æ ·é©¬ä¸Šå‘é€é€šçŸ¥ã€‚coalesceMask è®¾ç½®ä¸º 0 æ—¶ä¸ä¼šè¿›è¡Œå±è”½ï¼›å¦‚æœå°†ä»»æ„ä¸€ä¸ª coalesceMask æ”¹æˆ 1ï¼Œå¯¹åº”çš„é€šçŸ¥å°±ä¸ä¼šå‘é€ï¼›å¦‚æœå°†ä»»æ„ä¸€ä¸ª coalesceMask æ”¹æˆ 2ï¼Œç”±äºä¸‰ä¸ªé€šçŸ¥çš„å‘é€è€…éƒ½æ˜¯ selfï¼Œå› æ­¤ noti1ã€noti2ã€noti3 å…¨éƒ¨è¢«å±è”½ã€‚</p>
<h3 id="distributednotificationcenter">DistributedNotificationCenter</h3>
<p>å‰é¢æåˆ°çš„ NotificationCenter æ˜¯åœ¨åº”ç”¨è¿›ç¨‹å†…å‘å¯¹è±¡å‘é€é€šçŸ¥ã€‚Apple æä¾›äº† DistributedNotificationCenter ç±»æ¥å®ç°ä¸åŒçš„åº”ç”¨è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚æ¯ä¸€ä¸ªåº”ç”¨è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„ DistributedNotificationCenterï¼Œç”¨æ¥æ¥æ”¶å…¶ä»–è¿›ç¨‹å‘è¿‡æ¥çš„é€šçŸ¥ï¼ŒåŒæ—¶è´Ÿè´£å°†æœ¬è¿›ç¨‹çš„é€šçŸ¥å¹¿æ’­åˆ°å…¶ä»–è¿›ç¨‹çš„ DistributedNotificationCenter ä¸­ã€‚</p>
<p>åœ¨ä½¿ç”¨ä¸Šï¼ŒDistributedNotificationCenter å’Œè¿›ç¨‹å†…çš„ NotificationCenter å·®åˆ«ä¸å¤§ï¼ŒåŒæ ·æ˜¯é€šè¿‡ä¸€ä¸ªåä¸º <code>default</code> çš„ç±»å®ä¾‹è·å¾—é»˜è®¤çš„é€šçŸ¥ä¸­å¿ƒï¼Œé€šè¿‡ <code>addObserver</code> å’Œ <code>removeObserver</code> æ·»åŠ ã€ç§»é™¤è§‚å¯Ÿè€…ï¼Œé€šè¿‡ <code>post</code> å‘é€é€šçŸ¥ã€‚å¢åŠ äº†ä¸€ä¸ª Bool ç±»å‹çš„ <code>suspend</code> å±æ€§æ¥è®¾ç½®æ˜¯å¦æŒ‚èµ·é€šçŸ¥ä¸­å¿ƒï¼Œä¸æ¥æ”¶å’Œå‘é€è¿›ç¨‹é—´çš„é€šçŸ¥ã€‚</p>
<h2 id="ä¸‰-å‘ç”¨æˆ·å‘é€çš„é€šçŸ¥">ä¸‰ã€å‘ç”¨æˆ·å‘é€çš„é€šçŸ¥</h2>
<p>æœ¬èŠ‚è®¨è®º iOS æ¨é€ã€‚</p>
<h3 id="usernotificationsç”¨æˆ·é€šçŸ¥">UserNotificationsâ€”â€”ç”¨æˆ·é€šçŸ¥</h3>
<p>ä» iOS 10 èµ·ï¼Œç”¨æˆ·é€šçŸ¥ï¼ˆå³å‘ˆç°ç»™ç”¨æˆ·çš„æ¶ˆæ¯æ¨é€ï¼‰å‘ç”Ÿäº†è¾ƒå¤§å˜åŒ–ï¼ŒApple çš„ç›®çš„æ˜¯ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–ç”¨æˆ·é€šçŸ¥çš„ä½¿ç”¨ï¼Œå¹¶å‘å¼€å‘è€…æä¾›æ›´åŠ å¼ºå¤§çš„åŠŸèƒ½ï¼Œä½¿ç”¨æˆ·é€šçŸ¥èƒ½å¤Ÿå‘ˆç°æ›´å¤šçš„å†…å®¹ã€‚</p>
<p>ä½¿ç”¨ UserNotifications åˆ›å»ºç”¨æˆ·æ¨é€ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>Create a trigger. Depending on the situation that triggers a notification, select a different constructor.</li>
<li>Create the content of the notification, using UNMutableNotificationContent.</li>
<li>Create the request, using the trigger and content above.</li>
<li>Add the request to the notification center, using UNUserNotificationCenter.current().add()</li>
<li>Remember to ask the user for permission to show notification.</li>
<li>To provide attachment, use the UNNotificationAttachment class to add attachment to the notification.</li>
<li>To add an action in the notification, use UNNotificationAction and UNNotificationCategory
<ol>
<li>Create the action for the notification</li>
<li>Defines the category of the action</li>
</ol>
</li>
</ol>
<p>Just to remind: the majority of notification needs an identifier. Do not mess them up! It is recommended to use enum or at least constants to manage these identifiers.</p>
<p>æ•´ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„å›¾æ¥è¯´æ˜ï¼š</p>
<figure data-type="image" tabindex="4"><img src="https://andy_luo.gitee.io/blog_image_bed/img/user_notification_process.jpg" alt="åˆ›å»ºç”¨æˆ·æ¨é€çš„æµç¨‹" loading="lazy"></figure>
<h3 id="è·å¾—é»˜è®¤é€šçŸ¥ä¸­å¿ƒ">è·å¾—é»˜è®¤é€šçŸ¥ä¸­å¿ƒ</h3>
<p>å’Œ NotificationCenter ç›¸åŒï¼ŒUserNotifications åŒæ ·æœ‰ä¸€ä¸ªé€šçŸ¥ä¸­å¿ƒå¯¹æ•´ä¸ª App çš„æ¶ˆæ¯æ¨é€è¿›è¡Œç®¡ç†ã€‚å¯ä»¥ç”¨ <code>UNUserNotificationCenter.current()</code> è·å¾—é»˜è®¤çš„ç”¨æˆ·é€šçŸ¥ä¸­å¿ƒã€‚</p>
<h3 id="è·å–ç”¨æˆ·æƒé™">è·å–ç”¨æˆ·æƒé™</h3>
<p>éœ€è¦å¼¹å‡ºæ¨é€çš„ App éœ€è¦ç”³è¯·è·å¾—ç”¨æˆ·æƒé™ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ä¸ª Alert æ¡†ï¼š</p>
<figure data-type="image" tabindex="5"><img src="https://andy_luo.gitee.io/blog_image_bed/img/user_noti_request_permission.png" alt="ç”¨æˆ·æƒé™å¼¹çª—" loading="lazy"></figure>
<p>è¿™ä¸ªæ¡†ä¸æ˜¯ç”±å¼€å‘è€…è‡ªå·±å†™çš„ï¼Œè€Œæ˜¯ç”± iOS ç³»ç»Ÿå¼¹å‡ºæ¥çš„ã€‚å¯ä»¥ä½¿ç”¨é€šçŸ¥ä¸­å¿ƒçš„ <code>requestAuthorization(options:completionHandler:)</code> ç”³è¯·ä¸åŒçš„æƒé™ï¼ŒåŒ…æ‹¬æ¨é€å¼¹çª—ã€æç¤ºéŸ³ã€è§’æ ‡ç­‰ï¼Œå¹¶ä¸”åœ¨å›è°ƒçš„ handler ä¸­å¤„ç†ç”¨æˆ·çš„é€‰æ‹©ã€‚</p>
<pre><code class="language-swift">let center = UNUserNotificationCenter.current()
center.requestAuthorization(options: [.alert, .sound, .badge]) { granted, error in
    
    if let error = error {
        // Handle the error here.
    }
    
    // Enable or disable features based on the authorization.
    if granted {
      // user permit
    } else {
      // user deny
    }
}
</code></pre>
<p>é€šå¸¸æ˜¯åœ¨åº”ç”¨ç¬¬ä¸€æ¬¡æ‰“å¼€çš„æ—¶å€™å‘ç”¨æˆ·è¯·æ±‚æƒé™ï¼Œå› æ­¤é€šå¸¸æ˜¯åœ¨ AppDelegate çš„æ–¹æ³•ä¸­è°ƒç”¨ã€‚</p>
<h3 id="æ£€æŸ¥å½“å‰çš„æé†’è®¾ç½®">æ£€æŸ¥å½“å‰çš„æé†’è®¾ç½®</h3>
<p>ç”¨æˆ·å¯èƒ½ä¼šéšæ—¶æ›´æ”¹æé†’çš„æƒé™ï¼Œæ¯”å¦‚çªç„¶ä¸æƒ³æ¥æ”¶ App çš„æé†’äº†ï¼Œè¿™æ—¶å†è¿›è¡Œæ¨é€æ—¶æ— æ•ˆçš„ã€‚å¯ä»¥ä½¿ç”¨é€šçŸ¥ä¸­å¿ƒçš„ <code>getNotificationSettings(completionHandler:)</code> è·å¾—å½“å‰çš„æé†’è®¾ç½®ï¼Œä¾‹å¦‚ç”¨æˆ·æ˜¯å¦å…è®¸å¼¹çª—ç­‰ã€‚</p>
<pre><code class="language-swift">let center = UNUserNotificationCenter.current()
center.getNotificationSettings { settings in
    guard (settings.authorizationStatus == .authorized) ||
          (settings.authorizationStatus == .provisional) else { return }

    if settings.alertSetting == .enabled {
        // Schedule an alert-only notification.
    } else {
        // Schedule a notification with a badge and sound.
    }
}
</code></pre>
<h3 id="è®¾ç½®æ¨é€è§¦å‘å™¨">è®¾ç½®æ¨é€è§¦å‘å™¨</h3>
<p>æœ¬åœ°æ¨é€å¯ä»¥è®¾ç½®åœ¨æŸä¸ªæ—¶é—´æˆ–æ»¡è¶³æŸäº›æ¡ä»¶æ—¶å‘ç”¨æˆ·å‘é€é€šçŸ¥ï¼Œè¿™æ˜¯é€šè¿‡è®¾ç½®è§¦å‘å™¨ <code>UNNotificationTrigger</code> æ¥å®ç°çš„ï¼ŒåŒ…æ‹¬å››ç§ä¸åŒçš„è§¦å‘å™¨ï¼š</p>
<ul>
<li>UNCalendarNotificationTrigger</li>
<li>UNTimeIntervalNotificationTrigger</li>
<li>UNLocationNotificationTrigger</li>
<li>UNPushNotificationTrigger</li>
</ul>
<p>ä»å®ƒä»¬çš„åå­—å¯ä»¥çŸ¥é“ï¼Œåˆ†åˆ«æ˜¯åœ¨ç»™å®šæ—¥æœŸã€ç»™å®šæ—¶é—´é—´éš”ã€ç»™å®šä½ç½®è¿›è¡Œæ¨é€ï¼Œæœ€åä¸€ä¸ªæ˜¯æ‰‹åŠ¨è¿›è¡Œæ¨é€ã€‚ä¸åŒçš„ trigger æœ‰ä¸åŒçš„åˆå§‹åŒ–æ–¹æ³•ï¼ŒæŒ‰ç…§è¦æ±‚è¿›è¡Œè®¾ç½®å³å¯ã€‚</p>
<h3 id="è®¾ç½®æ¨é€å†…å®¹">è®¾ç½®æ¨é€å†…å®¹</h3>
<p>é€šè¿‡ UNMutableNotificationContent æ¥è®¾ç½®æ¨é€æ˜¾ç¤ºçš„å†…å®¹ï¼ŒåŒ…æ‹¬æ ‡é¢˜ï¼ˆtitleï¼‰ã€å‰¯æ ‡é¢˜ï¼ˆsubtitleï¼‰ã€ä¸»ä½“ï¼ˆbodyï¼‰ã€è§’æ ‡æ•°å­—ï¼ˆbadgeï¼‰ã€æç¤ºéŸ³ï¼ˆsoundï¼‰ã€è‡ªå®šä¹‰å†…å®¹ï¼ˆuserInfoï¼‰ã€é™„ä»¶ï¼ˆattachmentsï¼‰ç­‰ï¼Œå…¶ä¸­é™„ä»¶å¯ä»¥åŒ…å«æ–‡æœ¬æ–‡ä»¶ã€å›¾ç‰‡ç”šè‡³è§†é¢‘ï¼Œä½†æ˜¯æœ‰ä¸€å®šçš„æ¡ä»¶é™åˆ¶ï¼Œè¯¦æƒ…éœ€è¦æŸ¥é˜…<a href="https://developer.apple.com/documentation/usernotifications/unnotificationattachment">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<pre><code class="language-swift">let content = UNMutableNotificationContent()
content.title = NSString.localizedUserNotificationStringForKey(&quot;Hello!&quot;, arguments: nil)
content.body = NSString.localizedUserNotificationStringForKey(&quot;Hello_message_body&quot;, arguments: nil)
content.sound = UNNotificationSound.default()
</code></pre>
<blockquote>
<p>é™„å¸¦ä¸€æï¼Œåœ¨ Assets.xcassets ä¸­ï¼Œæœ‰ä¸¤æ ç”¨æ¥è®¾ç½® iPhone å’Œ iPad ä¸Šçš„æé†’å›¾æ ‡ã€‚</p>
</blockquote>
<h3 id="åˆ›å»ºæ¨é€è¯·æ±‚">åˆ›å»ºæ¨é€è¯·æ±‚</h3>
<p>è®¾ç½®å¥½è§¦å‘å™¨ trigger å’Œæ¨é€çš„å†…å®¹ content åï¼Œå°±å¯ä»¥é€šè¿‡ UNNotificatonRequest æ¥åˆ›å»ºæ¨é€è¯·æ±‚äº†ã€‚ä¸åŒçš„æ¨é€è¯·æ±‚é€šè¿‡ String ç±»å‹çš„ identifier æ¥è¿›è¡ŒåŒºåˆ†ï¼Œæœ€åå°† request æ·»åŠ åˆ°ç”¨æˆ·é€šçŸ¥ä¸­å¿ƒå³å¯ã€‚</p>
<pre><code class="language-swift">// Create the request
let uuidString = UUID().uuidString
let request = UNNotificationRequest(identifier: uuidString, 
            content: content, trigger: trigger)

// Schedule the request with the system.
let notificationCenter = UNUserNotificationCenter.current()
notificationCenter.add(request) { (error) in
   if error != nil {
      // Handle any errors.
   }
}
</code></pre>
<p>å¯ä»¥é€šè¿‡ <code>func getPendingNotificationRequests(completionHandler: ([UNNotificationRequest]) -&gt; Void)</code> è·å¾—æ‰€æœ‰è¿˜æ²¡è§¦å‘çš„ç”¨æˆ·é€šçŸ¥ã€‚</p>
<p>æ¨é€è¯·æ±‚ä¸€æ—¦åˆ›å»ºï¼Œåœ¨æ»¡è¶³è§¦å‘æ¡ä»¶ä¹‹å‰éƒ½ä¼šä¿æŒ active çš„çŠ¶æ€ã€‚å¦‚æœåœ¨åˆ›å»º trigger çš„æ—¶å€™è®¾ç½®äº† repeats ä¸º true çš„è¯ã€‚å¯ä»¥æ ¹æ® identifier æ¥å–æ¶ˆæŸä¸ªæ¨é€æˆ–è€…å–æ¶ˆæ‰€æœ‰æ¨é€ã€‚</p>
<pre><code class="language-swift">func removePendingNotificationRequests(withIdentifiers: [String])

func removeAllPendingNotificationRequests()
</code></pre>
<h3 id="è®¾ç½®ä»£ç†">è®¾ç½®ä»£ç†</h3>
<p>éµå¾ª UNUserNotificationDelegate åè®®çš„ç±»å¯ä»¥ä½œä¸º UserNotification çš„ä»£ç†ï¼Œæ¥æ”¶å¹¶å¤„ç†ç”¨æˆ·è¾“å…¥ã€å¦‚ä½•å¤„ç†æ¨é€ç­‰ã€‚<strong>Apple æç¤ºæˆ‘ä»¬éœ€è¦åœ¨ App å®Œæˆå¯åŠ¨ä¹‹å‰å®Œæˆä»£ç†çš„è®¾ç½®</strong>ï¼Œä»¤ AppDelegate éµé UNUserNotificationDelegate å³å¯ï¼Œå¹¶åœ¨ <code>application(_:didFinishLaunchingWithOptions:)</code> ä¸­è®¾ç½®ä»£ç†ä¸º selfã€‚</p>
<p>UNUserNotificationDelegate å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="language-swift">// ç”¨æˆ·è¡Œä¸ºå“åº”
func userNotificationCenter(UNUserNotificationCenter, didReceive: UNNotificationResponse, withCompletionHandler: () -&gt; Void)

// æ˜¾ç¤ºæœ¬åœ°æ¨é€
func userNotificationCenter(UNUserNotificationCenter, willPresent: UNNotification, withCompletionHandler: (UNNotificationPresentationOptions) -&gt; Void)

func userNotificationCenter(UNUserNotificationCenter, openSettingsFor: UNNotification?)
</code></pre>
<p><strong>å¿…é¡»è®¾ç½®ä»£ç†ä¹‹åï¼Œæœ¬åœ°æ¨é€æ‰èƒ½ç”Ÿæ•ˆã€‚</strong></p>
<h3 id="å¤„ç†ç”¨æˆ·è¾“å…¥">å¤„ç†ç”¨æˆ·è¾“å…¥</h3>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è®©æ¨é€å…·æœ‰ä¸ç”¨æˆ·äº¤äº’çš„åŠŸèƒ½ï¼Œç”¨æˆ·åœ¨çœ‹åˆ°æ¨é€ä¹‹åï¼Œåªéœ€è¦ç‚¹æŒ‰å¯ç”¨çš„é€‰é¡¹å°±èƒ½å¤Ÿå‘ App å‘å‡ºæŒ‡ä»¤ï¼Œè€Œä¸éœ€è¦çœŸæ­£è¿›å…¥åˆ° App ä¸­ã€‚é€šè¿‡ UNNotificationAction å’Œ UNNotificationCategory ç›¸ç»“åˆæ¥å£°æ˜ä¸€ä¸ªèƒ½å¤Ÿå“åº”ç”¨æˆ·è¾“å…¥çš„ actionã€‚</p>
<ul>
<li>UNNotificationAction</li>
</ul>
<p>å¯ä»¥ç†è§£ä¸ºé€šçŸ¥é™„å¸¦çš„æŒ‰é’®ï¼Œç”¨æˆ·å¯ä»¥ç‚¹å‡»æŒ‰é’®è¿›è¡Œäº¤äº’ã€‚</p>
<pre><code class="language-swift">// Define the custom actions.
let acceptAction = UNNotificationAction(identifier: &quot;ACCEPT_ACTION&quot;,
      title: &quot;Accept&quot;, 
      options: UNNotificationActionOptions(rawValue: 0))
let declineAction = UNNotificationAction(identifier: &quot;DECLINE_ACTION&quot;,
      title: &quot;Decline&quot;, 
      options: UNNotificationActionOptions(rawValue: 0))
</code></pre>
<p>ä¸åŒçš„ action é€šè¿‡ identifier æ¥è¿›è¡ŒåŒºåˆ†ï¼›title ä¸ºæŒ‰é’®çš„æ ‡ç­¾ï¼›option ä¸º action çš„é€‰é¡¹ï¼ŒåŒ…æ‹¬ authenticationRequiredï¼ˆä»…åœ¨è®¾å¤‡è§£é”çš„æ—¶å€™å¯ä»¥äº¤äº’ï¼‰ã€destructiveï¼ˆè¯¥è¡Œä¸ºå¯èƒ½å¯¼è‡´ä¸å¯é€†çš„åæœï¼‰ã€foregroundï¼ˆç”¨æˆ·éœ€è¦æ‰“å¼€ App ä½œè¿›ä¸€æ­¥çš„äº¤äº’ï¼‰ã€‚</p>
<ul>
<li>UNNotificationCategory</li>
</ul>
<p>Category å°† action è¿›è¡Œåˆ†ç±»ï¼Œåœ¨åˆ›å»º content çš„æ—¶å€™è®¾ç½® categoryIdentifierï¼Œå¯ä»¥è§„å®šå“ªäº›æ¨é€æ”¯æŒæ€ä¹ˆæ ·çš„è¡Œä¸ºã€‚</p>
<pre><code class="language-swift">// Define the notification type
let meetingInviteCategory = 
      UNNotificationCategory(identifier: &quot;MEETING_INVITATION&quot;,
      actions: [acceptAction, declineAction], 
      intentIdentifiers: [], 
      hiddenPreviewsBodyPlaceholder: &quot;&quot;,
      options: .customDismissAction)
// Register the notification type.
let notificationCenter = UNUserNotificationCenter.current()
notificationCenter.setNotificationCategories([meetingInviteCategory])

// set content's category identifier
content.categoryIdentifier = &quot;MEETING_INVITATION&quot;
</code></pre>
<p>å¤„ç†ç”¨æˆ·è¾“å…¥åˆ™æ˜¯åœ¨ä»£ç†æ–¹æ³• <code>func userNotificationCenter(UNUserNotificationCenter, didReceive: UNNotificationResponse, withCompletionHandler: () -&gt; Void)</code> ä¸­è¿›è¡Œçš„ï¼Œé€šè¿‡ response å‚æ•°çš„ actionIdentifier å±æ€§æ¥åŒºåˆ†ä¸åŒçš„ actionï¼Œéœ€è¦å’Œåˆ›å»º action çš„æ—¶å€™å®šä¹‰çš„ identifier å®Œå…¨ç›¸åŒæ‰èƒ½æ­£ç¡®è¯†åˆ«ã€‚</p>
<pre><code class="language-swift">func userNotificationCenter(_ center: UNUserNotificationCenter,
       didReceive response: UNNotificationResponse,
       withCompletionHandler completionHandler: 
         @escaping () -&gt; Void) {
       
   // Get the meeting ID from the original notification.
   let userInfo = response.notification.request.content.userInfo
   let meetingID = userInfo[&quot;MEETING_ID&quot;] as! String
   let userID = userInfo[&quot;USER_ID&quot;] as! String
        
   // Perform the task associated with the action.
   switch response.actionIdentifier {
   case &quot;ACCEPT_ACTION&quot;:
      sharedMeetingManager.acceptMeeting(user: userID, 
                                    meetingID: meetingID)
      break
        
   case &quot;DECLINE_ACTION&quot;:
      sharedMeetingManager.declineMeeting(user: userID, 
                                     meetingID: meetingID)
      break
        
   // Handle other actionsâ€¦
 
   default:
      break
   }
    
   // Always call the completion handler when done.    
   completionHandler()
}
</code></pre>
<h3 id="ç¤ºä¾‹ä»£ç -2">ç¤ºä¾‹ä»£ç </h3>
<p>æœ€åè´´ä¸€æ®µç¤ºä¾‹ä»£ç å§ï¼ˆéƒ¨åˆ†æ¥æº Apple Developer å®˜ç½‘ï¼‰ï¼š</p>
<ul>
<li>AppDelegate.swift</li>
</ul>
<pre><code class="language-swift">import UIKit
import UserNotifications

@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool {
        // Override point for customization after application launch.
        
        // è®¾ç½® UserNotifications ä»£ç†
        UNUserNotificationCenter.current().delegate = self
        
        // è¯·æ±‚æœ¬åœ°æ¨é€çš„æƒé™
        UNUserNotificationCenter.current().requestAuthorization(options: [.alert, .badge, .sound]) { granted, error in
            if let error = error {
                print(&quot;Oops, we've met an error: \(error)&quot;)
            }
            
            if granted {
                print(&quot;The user grants us the permission to push notificationsğŸ˜ƒ&quot;)
            } else {
                print(&quot;The user denies our permissionğŸ˜£&quot;)
            }
        }
        return true
    }
  
}

// ä»£ç†æ–¹æ³•
extension AppDelegate: UNUserNotificationCenterDelegate {
    public func userNotificationCenter(
      _ center: UNUserNotificationCenter, 
      didReceive response: UNNotificationResponse, 
      withCompletionHandler completionHandler: @escaping () -&gt; Void) {
        print(response.actionIdentifier)
        completionHandler()
    }
    
    func userNotificationCenter(
      _ center: UNUserNotificationCenter,
      willPresent notification: UNNotification,
      withCompletionHandler completionHandler: @escaping (UNNotificationPresentationOptions) -&gt; Void) {
        // New in iOS 10, we can show notifications when app is in foreground, by calling completion handler with our desired presentation type.
        print(&quot;something&quot;)
        // è®¾ç½®æé†’çš„æ–¹å¼ï¼š.alert, .sound, etc
        completionHandler(.alert)
    }
}

</code></pre>
<ul>
<li>ViewControler.swift</li>
</ul>
<pre><code class="language-swift">import UIKit
import UserNotifications

class ViewController: UIViewController {
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        // è®¾ç½®æ¨é€å†…å®¹
        let content = UNMutableNotificationContent()
        content.title = &quot;This is title&quot;
        content.subtitle = &quot;This is subtitle&quot;
        content.body = &quot;This is body&quot;
        content.sound = UNNotificationSound.default
        
        // å®šä¹‰ç”¨æˆ·äº¤äº’æ–¹å¼
        let acceptAction = UNNotificationAction(identifier: &quot;ACCEPT_ACTION&quot;,
              title: &quot;Accept&quot;,
              options: UNNotificationActionOptions(rawValue: 0))
        let declineAction = UNNotificationAction(identifier: &quot;DECLINE_ACTION&quot;,
              title: &quot;Decline&quot;,
              options: UNNotificationActionOptions(rawValue: 0))
        
        // å®šä¹‰æ¨é€èƒ½å¤Ÿå“åº”çš„äº¤äº’ç±»åˆ«
        let meetingInviteCategory =
              UNNotificationCategory(identifier: &quot;MEETING_INVITATION&quot;,
              actions: [acceptAction, declineAction],
              intentIdentifiers: [],
              hiddenPreviewsBodyPlaceholder: &quot;&quot;,
              options: .customDismissAction)
        
        // å‘é€šçŸ¥ä¸­å¿ƒæ³¨å†Œäº¤äº’ç±»åˆ«
        let notificationCenter = UNUserNotificationCenter.current()
        notificationCenter.setNotificationCategories([meetingInviteCategory])
        content.categoryIdentifier = &quot;MEETING_INVITATION&quot;
        
        // è®¾ç½®ä¸€ä¸ª 10 ç§’çš„è§¦å‘å™¨
        // è‹¥å¸Œæœ›é‡å¤æé†’ï¼ˆrepeats ä¸º trueï¼‰ï¼Œåˆ™ä¸¤æ¬¡æ¨é€çš„æ—¶é—´é—´éš”ï¼ˆtimeIntervalï¼‰å¿…é¡»å¤§äº 60ï¼Œå¦åˆ™ä¼šå´©æºƒã€‚
        let tenSecondsTrigger = UNTimeIntervalNotificationTrigger(timeInterval: 10, repeats: false)
        
        let request = UNNotificationRequest(identifier: &quot;tenSeconds&quot;, content: content, trigger: tenSecondsTrigger)
        
        UNUserNotificationCenter.current().add(request) { error in
            if let error = error {
                print(error)
            } else {
                print(&quot;Notification request added.&quot;)
            }
        }
    }
    
}
</code></pre>
<h2 id="äº”-æ€»ç»“">äº”ã€æ€»ç»“</h2>
<p>æœ¬ç¯‡æ–‡ç« å¯¹ NotificationCenter å’Œ UNUserNotification è¿›è¡Œäº†å­¦ä¹ ï¼Œå¯¹äºæˆ‘æ¥è¯´è®¤è¯†äº†ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Œå¹¶ä¸”çŸ¥é“äº†å¦‚ä½•æ ¹æ®æ¡ä»¶å¯¹ç”¨æˆ·å‘èµ·æ¨é€ã€‚éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ NotificationCenter å’Œ UNUserNotification éƒ½éå¸¸ä¾èµ–äºå­—é¢é‡çš„ identifier åŒºåˆ†ä¸åŒçš„é€šçŸ¥ï¼Œæœ€å¥½å°†å…¶è½¬æ¢æˆ struct æˆ– enumï¼Œé˜²æ­¢æ‰‹è¯¯ã€‚</p>
<p>å¦å¤–é™„ä¸Šä¸€ä¸ªæ›´åŠ å®Œæ•´çš„ <a href="https://github.com/AndyLuoJJ/NotificationDemo">demo</a>ï¼Œå°† NotificationCenter å’Œ UserNotifications çš„åŠŸèƒ½è¿›è¡Œç®€å•çš„æ•´åˆã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>
<ol>
<li>https://www.jianshu.com/p/209ef870e131</li>
<li>https://juejin.im/post/59422d5861ff4b006cc66be1</li>
<li>https://developer.apple.com/documentation/foundation/notificationcenter</li>
<li>https://developer.apple.com/documentation/usernotifications/unusernotificationcenter</li>
</ol>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E4%BB%8B%E7%BB%8D">ä¸€ã€ä»‹ç»</a></li>
<li><a href="#%E4%BA%8C-%E7%94%A8%E4%BA%8E%E5%BC%80%E5%8F%91%E7%9A%84%E9%80%9A%E7%9F%A5">äºŒã€ç”¨äºå¼€å‘çš„é€šçŸ¥</a>
<ul>
<li><a href="#notification-%E4%BB%8B%E7%BB%8D">Notification ä»‹ç»</a></li>
<li><a href="#notificationcenter">NotificationCenter</a>
<ul>
<li><a href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E8%A7%A3%E8%AF%BB">å®˜æ–¹æ–‡æ¡£è§£è¯»</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%9A%E7%9F%A5%E7%9A%84%E6%B3%A8%E5%86%8C%E5%92%8C%E5%93%8D%E5%BA%94">è‡ªå®šä¹‰é€šçŸ¥çš„æ³¨å†Œå’Œå“åº”</a></li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E9%80%9A%E7%9F%A5%E7%9A%84%E6%B3%A8%E5%86%8C%E5%92%8C%E5%93%8D%E5%BA%94">ç³»ç»Ÿé€šçŸ¥çš„æ³¨å†Œå’Œå“åº”</a></li>
</ul>
</li>
<li><a href="#notificationqueue">NotificationQueue</a>
<ul>
<li><a href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E8%A7%A3%E8%AF%BB-2">å®˜æ–¹æ–‡æ¡£è§£è¯»</a></li>
<li><a href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81">ç¤ºä¾‹ä»£ç </a></li>
</ul>
</li>
<li><a href="#distributednotificationcenter">DistributedNotificationCenter</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%90%91%E7%94%A8%E6%88%B7%E5%8F%91%E9%80%81%E7%9A%84%E9%80%9A%E7%9F%A5">ä¸‰ã€å‘ç”¨æˆ·å‘é€çš„é€šçŸ¥</a>
<ul>
<li><a href="#usernotifications%E7%94%A8%E6%88%B7%E9%80%9A%E7%9F%A5">UserNotificationsâ€”â€”ç”¨æˆ·é€šçŸ¥</a></li>
<li><a href="#%E8%8E%B7%E5%BE%97%E9%BB%98%E8%AE%A4%E9%80%9A%E7%9F%A5%E4%B8%AD%E5%BF%83">è·å¾—é»˜è®¤é€šçŸ¥ä¸­å¿ƒ</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90">è·å–ç”¨æˆ·æƒé™</a></li>
<li><a href="#%E6%A3%80%E6%9F%A5%E5%BD%93%E5%89%8D%E7%9A%84%E6%8F%90%E9%86%92%E8%AE%BE%E7%BD%AE">æ£€æŸ¥å½“å‰çš„æé†’è®¾ç½®</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E6%8E%A8%E9%80%81%E8%A7%A6%E5%8F%91%E5%99%A8">è®¾ç½®æ¨é€è§¦å‘å™¨</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E6%8E%A8%E9%80%81%E5%86%85%E5%AE%B9">è®¾ç½®æ¨é€å†…å®¹</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%8E%A8%E9%80%81%E8%AF%B7%E6%B1%82">åˆ›å»ºæ¨é€è¯·æ±‚</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86">è®¾ç½®ä»£ç†</a></li>
<li><a href="#%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5">å¤„ç†ç”¨æˆ·è¾“å…¥</a></li>
<li><a href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-2">ç¤ºä¾‹ä»£ç </a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E6%80%BB%E7%BB%93">äº”ã€æ€»ç»“</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">å‚è€ƒé“¾æ¥</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://AndyLuoJJ.github.io/post/organize-your-life-shi-yong-bei-wang-lu-ti-xing-shi-xiang-he-ri-li/">
              <h3 class="post-title">
                Organize your lifeâ€”â€”ä½¿ç”¨ã€Œå¤‡å¿˜å½•ã€ã€ã€Œæé†’äº‹é¡¹ã€å’Œã€Œæ—¥å†ã€
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://AndyLuoJJ.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()

  let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

  // This should probably be throttled.
  // Especially because it triggers during smooth scrolling.
  // https://lodash.com/docs/4.17.10#throttle
  // You could do like...
  // window.addEventListener("scroll", () => {
  //    _.throttle(doThatStuff, 100);
  // });
  // Only not doing it here to keep this Pen dependency-free.

  window.addEventListener("scroll", event => {
    let fromTop = window.scrollY;

    mainNavLinks.forEach((link, index) => {
      let section = document.getElementById(decodeURI(link.hash).substring(1));
      let nextSection = null
      if (mainNavLinks[index + 1]) {
        nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
      }
      console.log('section.offsetHeight', section.offsetHeight);
      if (section.offsetTop <= fromTop) {
        if (nextSection) {
          if (nextSection.offsetTop > fromTop) {
            link.classList.add("current");
          } else {
            link.classList.remove("current");    
          }
        } else {
          link.classList.add("current");
        }
      } else {
        link.classList.remove("current");
      }
    });
  });

</script>

      </div>
    </div>
  </body>
</html>
